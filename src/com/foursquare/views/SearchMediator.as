////////////////////////////////////////////////////////////
// Project: foursquair 
// Author: Seth Hillinger
// Created: Mar 7, 2010 
////////////////////////////////////////////////////////////

package com.foursquare.views
{
	import com.foursquare.events.CheckinEvent;
	import com.foursquare.events.SearchEvent;
	import com.foursquare.events.VenueEvent;
	import com.foursquare.models.vo.CityVO;
	import com.foursquare.views.search.SearchView;
	
	import mx.collections.ArrayCollection;
	
	import org.robotlegs.mvcs.Mediator;
	
	
	public class SearchMediator extends Mediator
	{

		[Inject]
		public var searchView:SearchView;
	
		public function SearchMediator()
		{
			super();
		}
		
		override public function onRegister() : void{
			eventMap.mapListener( searchView, SearchEvent.QUERY, doQuery );
			eventMap.mapListener( searchView, VenueEvent.VENUE_CHANGING, bounceVenueChanging );
		
			getUserLocation();
		}
		
		
		private function bounceVenueChanging( event:VenueEvent ):void{
			dispatch( event.clone() );
		}
		
		private function getUserLocation():void{
			eventDispatcher.dispatchEvent( new SearchEvent(SearchEvent.GET_USER_LOCATION) );
		}
		
		public function setUserLocation(cityVO:CityVO):void{
			searchView.setCity( cityVO );	
		}
		
		public function setQueryResults( results: ArrayCollection ):void{
			searchView.results = results;
		}
		
		private function doQuery(event:SearchEvent):void{
			eventDispatcher.dispatchEvent( event.clone() );
		}
	}
}